## 一、起步

####  wmqe-pms中展会项目启动流程：

		1. 启动redis	redis/start.bat
		2. 启动zookeeper		zookeeper-3.4.14/bin/zkServer.cmd
		3. 运行wmqe-gather-provider下的PmsProviderApplication
		4. 运行 ExpoWebServerApplication & WebServerApplication

#### 数据库：wmqe-pms/wmqe-expo/datasource

​		数据库脚本(DDL)：wmqe-expo.database.db_change_script.sql

​		数据库初始化数据脚本(DML)：wmqe-expo.database.data_change_script.sql

> 默认链接局域网内的数据库，需要使用公司的局域网络



## 二、项目结构

#### wmqe-expo-common    

>  expo项目公共模块

​		枚举(enums)：ExpoXxxEnum

​		工具类(util)：package com.wmqe.expo.common.util;

​		注解(annotation)：package com.wmqe.expo.common.util.annotation;

#### wmqe-expo-dao	

​		实体类(model)：ExpoXxx

​		映射器(mapper)：ExpoXxxMapper

​		映射关系(mappering)：ExpoXxxMappering					

​		**Generator(自动生成)**：内部含有main方法入口，修改对应的表名之后，运行main方法生成对应表的实体类、mapper、mapper.xml、dto、example（example为查询时使用的对象，可以添加查询条件）

​		resources目录：

​				数据库配置：generator.generator.preperties

​				自动生成类配置：generatorConfig.xml

​		代码生成流程：(先修改Generator类和resources下的generatorConfig.xml的表名、类名和路径，再运行Generator类)



#### wmqe-expo-model

​		dto：数据封装类	ExpoXxxDTO

​		example：用于添加数据库sql语句条件	ExpoXxxExample

​		query：查询条件	ExpoXxxQuery



#### wmqe-expo-service-api

​		ExpoXxxService：接口类	（可继承BaseService类）



#### wmqe-expo-service

​		ExpoXxxServiceImpl：接口实现类	（可继承BaseServiceImpl类）

​	新增service时，需修改Dubbo配置类，添加配置



#### wmqe-expo-provider    

>  微服务提供者

​				/resources/dubbo/：

​						spring-dubbo-provider.xml：微服务配置文件



#### wmqe-expo-web-server  

> 服务消费者
>
> 启动哪个服务提供者就配置哪个

​				/resources/dubbo/：

​						spring-dubbo-consumer.xml：微服务配置文件



#### wmqe-expo-web-admin

​		Controller层：

​				小程序：AppXxxController：

​				PC：WebXxxController

​				后台：ExpoXxxController

​		VO(返回数据封装)：

​				ExpoXxxVO						

​		请求返回数据类型：

​				ResponseEntity类（需继承ExpoBaseController类）

​				BaseResult类：统一返回结果类

​		Swagger文档注解：

​				(例)	VO类：@ApiModelProperty("主键id")	属性

​						  Controller类：

​									@Api(value = "报名登记", description = 报名登记")	类

​									@ApiOperation(value = "登记信息分页查询")		方法

​									@ApiParam(value = "查询条件")		参数

> cms包：文章相关包
>
> expoinfo包：展会相关包
>
> guest包：嘉宾相关包
>
> history包：往届展会
>
> inquiry包：展会统计
>
> query包：后台综合查询
>
> reg包：注册（报名）
>
> sys：展会区划管理
>
> ticket包：二维码
>
> userinfo包：个人中心相关包



> ** /web/ ** 是pc端的接口
>
> ** /micro/ ** 是小程序端的接口



#### wmqe-mq

​		wmqe-mq-send-api

​				SendService：消息发送接口



Idea swagger插件：RestfulToolkit			



#### wmqe-frame

> 项目框架，存放了一些项目框架的基础接口、类、工具类，为所有项目提供模板

- *wmqe-frame-common*
  - util          公共工具包
- *wmqe-frame-db*
  - BaseMapper         基础映射器，项目的mapper多数继承于此接口，继承了mybatis的Mapper<T>, IdsMapper<T>, InsertListMapper<T>，包含了基本的增删改查函数。
- *wmqe-frame-model*
  - BaseQuery          基础查询类，包含了pageNum、pageSize和startRow，配合PageHelper完成分页查询
- *wmqe-frame-service*
  - BaseServiceImpl         基础业务类，实现了BaseService，提供了常用的的增删改查业务
- *wmqe-frame-service-api*
  - BaseService        基础业务类接口



## 三、操作

#### dao

##### mapper、mapper.xml、POJO

- 通过generator类生成dao层对象

> 生成的mapper类继承了mybatis的BaseMapper类，不用在书写基础的增删改查

##### wmqe-expo-model

- 将model包下的example剪切到wmqe-expo-model中的example包

- 在wmqe-expo-model中的dto和query包中，按照需求设计dto和query类

> 自定义的query类应该应该继承定义好的BaseQuery类





#### Service

##### 步骤

- 在wmqe-expo-service-api中定义接口，可以继承BaseService

- 在wmqe-expo-service中实现接口，如果父类继承了BaseService，则子类要继承BaseServiceimpl

   ![image-20210326142047688](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210326142047688.png)

> BaseServiceimpl中包含了基础的增删改查方法

- 在wmqe-gather-provider中配置dubbo，暴露服务接口，例

```xml
<bean id="goodsInfoService" class="com.wmqe.expo.service.impl.goodsinfo.GoodsInfoServiceImpl"/>
<dubbo:service interface="com.wmqe.expo.service.api.goodsinfo.GoodsInfoService" ref="goodsInfoService" retries="1" timeout="30000"/>
```

> 谁提供服务配置谁



- 在wmqe-expo-web-server中配置dubbo，订阅服务，例

```xml
<dubbo:reference id="goodsInfoService" interface="com.wmqe.expo.service.api.goodsinfo.GoodsInfoService" />
```

> 谁使用服务配置谁



##### BaseService

- 基础服务类

##### BaseServiceImpl

- 基础服务实现类，实现了基础的数据库相关业务

> 添加和删除推荐使用带有Selective结尾的方法，此方法不会添加没有赋值的字段属性







#### Controller

- 根据前端设计vo

- 在wmqe-expo-admin中编写controller,继承ExpoBaseController，请求Mapping的返回值要求统一返回ResponseEntity<BaseResult<T>>,例

~~~java
@GetMapping("/select_page")
    public ResponseEntity<BaseResult<GoodsInfoVO>> selectpage(){
        GoodsInfoVO vo = new GoodsInfoVO();
        return this.responseOK(vo);
    }
~~~

##### ExpoBaseController

- 展会项目基础控制器类，expo中的Controller应该继承该类

##### ResponseEntity

- 统一返回类型

##### BaseResult

- BaseResult类中包含了状态码、状态信息、响应数据，可按需求进行填充；

~~~java
// 状态码：1成功，其他为失败
    @ApiModelProperty(value="状态码")
    public int code;

    // 成功为success，其他为失败原因
    @ApiModelProperty(value="状态信息")
    public String message;

    // 数据结果集
    @ApiModelProperty(value="响应数据")
    public T data;
~~~

##### BaseController

- expoBaseController最上层继承自BaseController，BaseController中包含了返回值为ResponseEntity<BaseResult<T>>的方法，使用这些方法来完成请求的返回。



![](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210326142152628.png)



![image-20210328200924781](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328200924781.png)





#### 异常处理

- 在BaseController中设有异常处理柄

```java
@ExceptionHandler
    public ResponseEntity<BaseResult> exceptionHandler(HttpServletRequest request, HttpServletResponse response, Exception exception) {}
```

> 该方法会拦截由继承了BaseController的控制器抛出的异常并将错误信息作为响应信息返回到前端。拦截的异常包括ClientUnauthenticatedException、UnauthenticatedException、UnauthorizedException、InvalidSessionException、MethodArgumentNotValidException、BussinessException





#### 公共工具类

##### 路径

- 大部分项目工具类放在/wmqe-frame/wmqe-frame-common下的com.frame.common.util包中

##### BeanUtil

- 继承自Spring的BeanUtils

> 内部包含了transBean与copyProperty等方法，可以实现不同类型对象的复制和转换

##### Converter      

- 类型转换工具类

##### ConvertMoney

- 人民币转大写汉字



##### DateUtil          

- 日期工具类



##### EncodeUtil     

- 编码工具类



##### ExcelUtil           

- excel工具类



##### validateUtil      

- 校验工具类



##### Validator

- 简易校验工具类



##### UrlUtil               

- 解析url



##### UUIDUtil           

- 生成uuid



##### AlikAssert         

- 断言类，根据判断规则抛出业务异常



##### StringUtil          

- 处理字符串



##### ExcelImportUtil     

- poi的excel导入处理工具



##### CodeUtil

- 编码生成工具



##### B2bApiUtil

##### VCodeValidUtil

##### SecurityUtils

##### JwtHelper

##### HttpUtils

##### WxMiniAppUtil

##### EmailUtil

##### JavaMailSender

##### SmsSender

##### SmsHandler

##### CaptchaUtil



#### 常用枚举

##### BaseEnum

##### DelFlagEnum

- 删除标记枚举类

##### BankEnum

##### UseableFlagEnum

- 启用枚举类



##### YesOrNoEnum

- 标记枚举类



##### ExpoRoleTypeEnum

##### ExpoSessionStatusEnum

##### ExpoRegisterTypeEnum

##### SmsBizTypeEnum

##### AuditStatusEnum

##### SourcePlatformEnum

##### AdvertPositionStatusEnum

##### CardTypeEnum

##### ExpoSessionStatusEnum

##### ExhibitorisOfflineRegEnum

##### ExpoExhibitorApplyIsCurrentEnum

##### ExpoInfoStatusEnum



#### 其他

##### SysDict

##### BaseResultConstants

##### BaseConstants：公共常量

##### UmsConstants



#### 常用链接

> 地址大全：http://login.wmqe.com/ 
>
> 展会服务平台sit环境
>
> sit环境主页：https://sit.hbwhexpo.com/ 
>
> sit环境后台：https://sit.hbwhexpo.com/admin/login.html   账号/密码： expoadmin/123456 
>
> mysql： 地址192.168.1.159   
>
> ​				用户名：pms
>
> ​				密码  wmqe123   
>
> ​				展会数据库(pms_health_expo)
>
> swagger文档地址： http://127.0.0.1:8081/wmqe/swagger-ui.html 
>
> svn文档地址： http://svn-local.wmqe.com:18080/svn/product-html/    账号：yanfa  密码：yanfa@123
>
> 需求原型地址：http://product.wmqe.com/ 
>
> 禅道、gitlab 等分配账号



## 附录

| 接口作用                         |        | 地址                                                   | 参数                                      |
| -------------------------------- | ------ | ------------------------------------------------------ | ----------------------------------------- |
| 展商注册                         | POST   | /api/userInfo/web/exhibitors/register                  | ExpoExhibitorRegisterVo                   |
| pc开关列表                       | POST   | /api/userInfo/web/expoLabSwitch/all                    | ExpoLabSwitchQuery                        |
| 获取当前登录用户token与姓名      | GET    | /api/userInfo/web/exhibitors/login-info                |                                           |
| 登录                             | POST   | /api/userInfo/web/exhibitors/login                     | ExpoExhibitorRegisterVo                   |
| 退出登录                         | POST   | /api/userInfo/web/exhibitors/logout                    |                                           |
| 发送验证码                       | GET    | /vercode/send-sms-captcha                              | 手机号、验证码                            |
| 检测手机号/邮箱是否注册          | GET    | /api/userInfo/web/exhibitors/checkUser                 | mobileOrEmail，registerType，type（身份） |
|                                  |        |                                                        |                                           |
| 企业信息登记时获取企业信息       | GET    | /api/userInfo/web/exhibitors/apply/info                |                                           |
| 获取下级区划信息                 | GET    | /api/expo/region/dyna_tree                             |                                           |
| 添加企业信息                     | POST   | /api/userInfo/web/exhibitors/apply/save                | ExpoExhibitorApplyVO                      |
|                                  |        |                                                        |                                           |
|                                  |        |                                                        |                                           |
| 报名时获取企业信息               | GET    | /api/userInfo/web/exhibitors/getSignUp                 |                                           |
| 参展报名                         | POST   | /api/userInfo/web/exhibitors/signUp                    | ExpoRegExhibitorVO                        |
|                                  |        |                                                        |                                           |
| 高峰论坛列表查询                 | POST   | /api/userInfo/web/forum/reg/all                        |                                           |
| 论坛报名                         | POST   | /api/userInfo/web/forum/reg/save/{forumId}             | 论坛ID                                    |
|                                  |        |                                                        |                                           |
| 我的展位列表                     | GET    | /api/userInfo/web/exhibitor/booth/all                  |                                           |
|                                  |        |                                                        |                                           |
| 我的展品                         | POST   | /api/userInfo/web/reg/exhibitor/prod/search            | ExpoRegExhibitorProdQuery                 |
| 添加展品                         | POST   | /api/userInfo/web/reg/exhibitor/prod/save              | ExpoRegExhibitorProdVO                    |
| 根据id查询商品                   | GET    | /api/userInfo/web/reg/exhibitor/prod/{id}              | （路径参数）展品ID                        |
| 根据id修改商品                   | PUT    | /api/userInfo/web/reg/exhibitor/prod/                  | ExpoRegExhibitorProdVO                    |
| 根据id删除商品                   | DELETE | /api/userInfo/web/reg/exhibitor/prod/{id}              | （路径参数）展品ID                        |
| 发布/撤下商品                    | PUT    | /api/userInfo/web/reg/exhibitor/prod/publish           | ExpoRegExhibitorProdVO                    |
|                                  |        |                                                        |                                           |
| 随行人员列表                     | POST   | /api/userInfo/web/expoRegAccompany/list                | ExpoMyAccompanyQuery                      |
| 根据id获取随行人员信息           | GET    | /api/userInfo/web/expoRegAccompany/{id}                | （路径参数）人员ID                        |
| 添加/修改随行人员                | POST   | /api/userInfo/web/expoRegAccompany/regAccompany        | ExpoRegAccompanyVO                        |
| 根据id获取随行人员信息           | DELETE | /api/userInfo/web/expoRegAccompany/{id}                | （路径参数）人员ID                        |
|                                  |        |                                                        |                                           |
| 用户往届参展记录查询             | GET    | /api/userInfo/web/user/history/all                     |                                           |
| 资源下载列表                     | GET    | /api/userInfo/web/expoSource/list                      | List<ExpoSourceVo>                        |
|                                  |        |                                                        |                                           |
| 获取指定展商登记信息             | GET    | /registration/web/exhibitors/{id}                      | （路径参数）展商ID、展位ID                |
| 获取展商二维码                   | GET    | /registration/qrcode/{id}                              | （路径参数）展商ID                        |
| 获取展商名录（可输入关键字查询） | POST   | /exhibitors/catalog                                    | ExpoExhibitorQuery                        |
|                                  |        |                                                        |                                           |
| 获取展会信息                     |        | /history/web/expoinfo                                  |                                           |
| 获取展商信息                     |        | /exhibitor/catalog                                     |                                           |
|                                  |        |                                                        |                                           |
|                                  |        |                                                        |                                           |
|                                  |        |                                                        |                                           |
|                                  |        |                                                        |                                           |
|                                  |        |                                                        |                                           |
| **小程序**                       |        |                                                        |                                           |
| 检测手机号/邮箱是否注册          | GET    | /api/userInfo/micro/exhibitors/checkUser               | mobileOrEmail，registerType，type（身份） |
| 展商注册                         | POST   | /api/userInfo/micro/exhibitors/register                | ExpoExhibitorRegisterVo                   |
| 登录                             | POST   | /api/userInfo/micro/exhibitors/login                   | ExpoExhibitorRegisterVo                   |
| 退出登录                         | POST   | /api/userInfo/micro/exhibitors/logout                  |                                           |
|                                  |        |                                                        |                                           |
| 企业信息登记时获取企业信息       | GET    | /api/userInfo/micro/exhibitors/apply/info              |                                           |
| 新增展商登记信息                 | POST   | /api/userInfo/micro/exhibitors/apply/save              | ExpoExhibitorApplyVO                      |
|                                  |        |                                                        |                                           |
|                                  |        |                                                        |                                           |
| 报名时获取企业信息               | GET    | /api/userInfo/micro/exhibitor/reg/getSignUp            |                                           |
| 参展报名                         | POST   | /api/userInfo/micro/exhibitor/reg/signUp               | ExpoRegExhibitorVO                        |
|                                  |        |                                                        |                                           |
| 高峰论坛列表查询                 | POST   | /api/userInfo/micro/forum/reg/all                      |                                           |
| 论坛报名                         | POST   | /api/userInfo/micro/forum/reg/save/{forumId}           | 论坛ID                                    |
|                                  |        |                                                        |                                           |
| 我的展位列表                     | GET    | /api/userInfo/micro/exhibitor/booth/all                |                                           |
|                                  |        |                                                        |                                           |
| 我的展品                         | POST   | /api/userInfo/micro/exhibitor/prod/list                | ExpoRegExhibitorProdQuery                 |
| 添加展品                         | POST   | /api/userInfo/micro/exhibitor/prod/save                | ExpoRegExhibitorProdVO                    |
| 根据id查询商品                   | GET    | /api/userInfo/micro/exhibitor/prod/{id}                | （路径参数）展品ID                        |
| 根据id修改商品                   | PUT    | /api/userInfo/micro/exhibitor/prod/                    | ExpoRegExhibitorProdVO                    |
| 根据id删除商品                   | DELETE | /api/userInfo/micro/exhibitor/prod/{id}                | （路径参数）展品ID                        |
| 发布/撤下商品                    | PUT    | /api/userInfo/micro/exhibitor/prod/publish             | ExpoRegExhibitorProdVO                    |
|                                  |        |                                                        |                                           |
| 随行人员列表                     | GET    | /api/userInfo/micro/expoRegAccompany/list              | ExpoMyAccompanyQuery                      |
| 根据id获取随行人员信息           | GET    | /api/userInfo/micro/expoRegAccompany/{id}              | （路径参数）人员ID                        |
| 添加/修改随行人员                | POST   | /api/userInfo/micro/expoRegAccompany/regAccompany      | ExpoRegAccompanyVO                        |
| 根据id获取随行人员信息           | DELETE | /api/userInfo/micro/expoRegAccompany/{id}              | （路径参数）人员ID                        |
|                                  |        |                                                        |                                           |
| 用户往届参展记录查询             | GET    | /api/userInfo/micro/user/history/all                   |                                           |
| 资源下载列表                     | GET    | /api/userInfo/micro/expoSource/list                    | List<ExpoSourceVo>                        |
|                                  |        |                                                        |                                           |
| 获取指定展商登记信息             | GET    | /registration/micro/exhibitors/{id}                    | （路径参数）展商ID、展位ID                |
|                                  |        |                                                        |                                           |
|                                  |        |                                                        |                                           |
|                                  |        |                                                        |                                           |
| **后台**                         |        |                                                        |                                           |
| 分页查询                         | POST   | /registration/exhibitors/search                        | ExpoRegExhibitorQuery                     |
| 更新展商数据                     | PUT    | /registration/exhibitors                               | ExpoRegExhibitorVO                        |
| 获取展商信息                     | GET    | /registration/exhibitors/{id}                          | （路径参数）展商ID                        |
| 参展商下届登记信息分页查询       | POST   | /registration/next/search                              | ExpoRegExhibitorNextQuery                 |
| 后台嘉宾行程获取参与论坛         | GET    | /forums/getByType                                      | type                                      |
| 论坛报名                         | POST   | /api/userInfo/admin/dealer/reg/search                  | ExpoRegDealerQuery                        |
| 发送短信                         | POST   | /api/userInfo/admin/dealer/reg/send/message            | regDealerIds（报名id列表）                |
| 查询论坛报名记录                 | POST   | /api/userInfo/admin/forum/focus/record/search          | ExpoForumRecordQuery                      |
| 获取指定展商登记信息             | GET    | /api/userInfo/admin/exhibitors/{id}                    | （路径参数）展商ID                        |
| 快速注册报名                     |        | /api/userInfo/admin/exhibitors/registerAll             |                                           |
|                                  |        |                                                        |                                           |
| 展区分配分页查询                 | POST   | /areas/allot/regExhibitor/search                       | ExpoAreaRelationQuery                     |
| 获取展商信息列表                 | POST   | /exhibitors/search                                     | ExpoExhibitorQuery                        |
| 根据id获取展商信息               | GET    | /exhibitors/{id}                                       | （路径参数）展商ID                        |
| 根据类型获取头衔                 | GET    | exhibitors/listTagByType                               | tagType                                   |
| 移出分配展商                     | POST   | /areas/allot/regExhibitor/delete                       | ExpoAreaRelationVO                        |
| 展位分配分页查询                 | POST   | /booths/distribut/search                               | ExpoBoothQuery                            |
| 展位查询                         | GET    | /areas/dyna_tree                                       | expoSessionId、pid                        |
| 展位分配是获取信息               | GET    | /booths/{id}                                           | id                                        |
| 更新展区分配                     | PUT    | /booths/distribut                                      | ExpoBoothVO                               |
|                                  |        |                                                        |                                           |
| 随行人员列表                     | POST   | /api/userInfo/admin/expoRegAccompany/list              | ExpoMyAccompanyQuery                      |
|                                  |        |                                                        |                                           |
| 获取展商信息列表                 | POST   | /api/userInfo/admin/exhibitors/apply/list              | ExpoExhibitorApplyQuery                   |
|                                  |        |                                                        |                                           |
| 审核通过/拒绝                    | PUT    | /api/userInfo/admin/exhibitors/apply/audit             | ExpoExhibitorApplyVO                      |
| 获取展商申请信息                 | GET    | /api/userInfo/admin/exhibitors/apply/{id}              | id                                        |
| 查询论坛报名审核                 | POST   | /api/userInfo/admin/forum/focus/audit/search           | ExpoForumAuditQuery                       |
| 论坛报名审核                     | PUT    | /api/userInfo/admin/forum/focus/audit                  | ExpoForumAuditVO                          |
| 人员所属展商下拉框列表           | POST   | /exhibitors/opte/exhibitor                             | ExpoExhibitorQuery                        |
| 展品分页查询                     | POST   | /api/userInfo/admin/reg/exhibitor/prod/audit/search    | ExpoRegExhibitorProdQuery                 |
| 展品审核                         | PUT    | /api/userInfo/admin/reg/exhibitor/prod/audit           | ExpoRegExhibitorProdQuery                 |
| 展品详情                         | GET    | /api/userInfo/admin/reg/exhibitor/prod/{id}            | （路径参数）展品ID                        |
|                                  |        |                                                        |                                           |
| 展商展位查询                     | POST   | /diverse/exhibitor/booth/search                        | ExpoExhibitorBoothQuery                   |
| 获取馆长可分配的负责展区         | GET    | /areas/distribution                                    |                                           |
| 展商查询（头衔）                 | POST   | /api/query/admin/search/exhibitor-summary              | ExpoExhibitorSummaryQuery                 |
|                                  |        |                                                        |                                           |
| 展商汇总统计(按展位类型)         | POST   | /api/userInfo/admin/exhibitor/statistics/position/list | ExpoExhibitorPositionQuery                |





--author：陈源
