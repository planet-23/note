## PC端

#### 展商注册

1. 验证手机号                             /api/userInfo/web/exhibitors/checkUser 

   > 首先查询redis判断当届展会是否开启，未开启不能操作
   >
   > 判断注册的用户类型
   >
   > 如果是展商，调用 b2bApiUtil.checkPhone(mobileOrEmail)校验手机号是否注册

   

2. 发送短信验证码（图形验证码）       /vercode/send-sms-captcha

   > 先验证手机号
   >
   > 再验证图形验证码，CaptchaUtil.verify(captchaVerification, mobile)
   >
   > 生成验证码，存入数据库
   >
   > 发送验证码

   

3. 发送邮件验证码（图形验证码） /vercode/send-email-captcha

   > 再验证图形验证码，CaptchaUtil.verify(captchaVerification, mobile)
   >
   >生成验证码，存入session
   >
   >发送验证码

   

4. 注册                                         /api/userInfo/web/exhibitors/register

   > 校验当前届期是否开启
   >
   > 核对信息
   >
   > 核对验证码
   >
   > 调用b2bApiUtil.register（）注册
   >
   > 注册成功后，将token存入session
   >
   > 发送短信通知

   

#### 展商登录

1. 登录                                 /api/userInfo/web/exhibitors/login

   > 校验当前届期是否开启
   >
   > 验证手机号、密码（验证码）
   >
   > 调用b2bApiUtil.ssoLogin（）登录
   >
   > 登录成功则将token存入session
   >
   > 返回登录信息

   

2. 退出登录                        /api/userInfo/web/exhibitors/logout

   >调用JwtHelper.logout();
   >
   >删除session中的保留的token



#### 展商登记

1. 获取展商信息（优先登记表）                  /api/userInfo/web/exhibitors/apply/info

   > 获取userid
   >
   > 根据userid查询展商基础信息，tb_expo_exhibitor
   >
   > 根据userid查询展商登记最新信息，tb_expo_exhibitor_apply
   >
   > 如果登记信息不为空，将登记信息返回
   >
   > 如果登记信息为空，则返回展商基础信息，并设置状态码为3

   

2. 获取地址区分级                      /api/expo/region/dyna_tree

   > 根据传入的pid查询tb_sys_region表
   >
   > 如果没有传入pid参数，则默认查询区域类型为0和 1的区域
   >
   > 按照区划编码排序
   >
   > 转化后返回

   

3. 登记（待审核）                                      /api/userInfo/web/exhibitors/apply/save

   > 验证信息
   >
   > 获取userid，根据userid获取展商基础信息，tb_expo_exhibitor
   >
   > 设置登记dto类信息（状态为待审核）
   >
   > 插入tb_expo_exhibitor_apply



#### 展商服务

##### 展会报名

1. 获取当前用户token和用户名           /api/userInfo/web/exhibitors/login-info

   > 通过session获取用户token
   >
   > 通过JwtHelpper获取用户名
   >
   > 返回token和用户名

   

2. 获取企业信息（优先报名表）                                     /api/userInfo/web/exhibitors/getSignUp 

   > 使用JwtHelpper获取展商id
   >
   > 根据展商id获取展商展会报名信息，tb_expo_reg_exhibitor
   >
   > 查询是如果展商展会报名信息为空，则使用展商基础信息，tb_expo_exhibitor
   >
   > 返回展商报名信息

   

3. 报名（待审核）                                      /api/userInfo/web/exhibitors/signUp

   >验证参数
   >
   >赋值展商报名dto的字段，展商id、userid等等               JwtHelper
   >
   >获取当届展会信息
   >
   >根据展商id获取当前展商信息
   >
   >根据展会id和userid查询是否有已经通过审核和待审核的展商信息
   >
   >如果展商是待审核或者已通过报名的则返回2
   >
   >如果不存在待审核或者已通过报名，则插入当前展商信息到报名表，tb_expo_reg_exhibitor
   >
   >插入展商信息到报名表成功后，则插入展商报名意图表、获取渠道表，然后返回1，tb_expo_reg_exhibitor_purpose,tb_expo_reg_exhibitor_channel
   >
   >如果返回值为1（成功），则根据注册的方式发送短信或者邮件，返回前端注册成功
   >
   >如果返回值为2，则提示用户已经报名，不要重复报名
   >
   >其他情况为报名失败

   

##### 论坛报名

1. 获取论坛列表                                    /api/userInfo/web/forum/reg/all

   > 使用JwtHelpper获取当前userid，根据用户id获取展商信息
   >
   > 获取当届展会信息，检验当届展会是否开启
   >
   > 查询本届所有已发布的高峰论坛                      tb_expo_forum
   >
   > 遍历上述结果，根据论坛id和展商id查询论坛报名表     tb_expo_forum_focus
   >
   > 如果没有查询到，则表明当前论坛没有报名，设置报名状态为（3）
   >
   > 返回论坛vo列表

   

2. 论坛报名                                          /api/userInfo/web/forum/reg/save/{forumId}

   > 使用JwtHelpper获取当前userid，根据用户id获取展商信息
   >
   > 根据展商id、论坛id、用户类型查询是否有待审核和审核通过的报名信息        tb_expo_forum_focus
   >
   > 如果有则表示已经报名，返回状态-2
   >
   > 根据论坛id获取论坛最大报名数            tb_expo_forum
   >
   > 统计根据论坛id获取已报名到审核或者成功的数量                 tb_expo_forum_focus
   >
   > 如果超出最大报名数，不予报名，返回-3
   >
   > 否者插入报名信息到论坛报名表                             tb_expo_forum_focus

 

##### 展位列表                       

获取展位列表                                           /api/userInfo/web/exhibitor/booth/all

> 使用JwtHelpper获取当前userid，根据用户id获取展商信息
>
> 从redis或者数据库获取当届展会信息
>
> 根据展会id、展商id获取时间逆序的展商展会报名信息               tb_expo_reg_exhibitor
>
> 如果为空这表示没有报名，不能使用改功能
>
> 如果审核通过，再根据展商报名id、展会id、展商id联表查询展商详细信息                           //getExhibitorCatalog         
>
> 根据ParentId获取其展管，并将展馆名赋值到expoUserHistoryDTO
>
> 将展区展位信息赋值到expoUserHistoryDTO
>
> 返回





##### 展品

1. 查询展品                                        /api/userInfo/web/reg/exhibitor/prod/search

   > 使用JwtHelpper获取当前userid，根据用户id获取展商信息            tb_expo_exhibitor
   >
   > 根据展商id查询展商展品信息
   >
   > 将dto转换成vo，返回商品分页数据

   

2. 添加展品（待审核）                   /api/userInfo/web/reg/exhibitor/prod/save

   > 校验添加的商品信息
   >
   > 使用JwtHelpper获取当前userid，根据用户id获取展商信息            tb_expo_exhibitor
   >
   > 使用count函数根据展商id统计当前展商的展品数量，如果大于49，则不能添加新的展品                        tb_expo_reg_exhibitor_prod
   >
   > 设置新展品的属性，（待审核，未发布）
   >
   > 添加到数据库              tb_expo_reg_exhibitor_prod

   

3. 查询（GET）                               /api/userInfo/web/reg/exhibitor/prod/{id}

   > 验证id是否为空
   >
   > 根据id查询 tb_expo_reg_exhibitor_prod
   >
   > 转换为vo返回

   

4. 删除（DELETE）                           /api/userInfo/web/reg/exhibitor/prod/{id}

   > 验证id是否为空
   >
   > 设置展品删除标记为删除，发布状态为未发布
   >
   > 根据id更新 tb_expo_reg_exhibitor_prod

   

5. 发布/撤下                                      /api/userInfo/web/reg/exhibitor/prod/publish

   > 验证id和发布状态
   >
   > 根据id获取展品信息
   >
   > 如果当前展品没有审核通过，不予发布
   >
   > 使用JwtHelpper获取当前userid，根据用户id获取展商信息            tb_expo_exhibitor
   >
   > 根据id修改发布状态和修改者信息                                        tb_expo_reg_exhibitor_prod

   

6. 修改（未发布）                          /api/userInfo/web/reg/exhibitor/prod/

   > 验证需要修改的参数数据
   >
   > 使用JwtHelpper获取当前userid，根据用户id获取展商信息            tb_expo_exhibitor
   >
   > 使用count函数根据展商id统计当前展商的展品数量，如果大于50，则不能操作                        tb_expo_reg_exhibitor_prod
   >
   > 根据展品id获取当前展品信息，如果是发布状态，则提示用户不能修改，必须先撤下
   >
   > 设置修改信息，审核状态设置为待审核，设置修改者信息

 

##### 随行人员

1. 获取随行人员                          /api/userInfo/web/expoRegAccompany/list

   > 使用JwtHelpper获取当前展商id，根据展商id获取展商信息            tb_expo_exhibitor
   >
   > 从redis或者数据库获取最近开启的展会信息
   >
   > 根据展商id和展会id查询展会报名审核通过的展商信息，如果为查询到，则表明报名没有审核成功，不能使用该功能           tb_expo_reg_exhibitor
   >
   > 根据报名表id、展会id、角色类型（展商）查询，分页查询随行人员信息                      tb_expo_reg_accompany
   >
   > 返回

   

2. 添加/修改随行人员                         /api/userInfo/web/expoRegAccompany/regAccompany

   > 验证人员信息
   >
   > 使用注解验证身份证号码
   >
   > 使用JwtHelpper获取当前展商id，根据展商id获取展商信息            tb_expo_exhibitor
   >
   > 从redis或者数据库获取最近开启的展会信息
   >
   > 根据展商id和展会id查询展会报名审核通过的展商信息，如果为查询到，则表明报名没有审核成功，不能使用该功能           tb_expo_reg_exhibitor
   >
   > 根据报名表id、展会id、角色类型（展商）查询所有随行人员信息
   >
   > 比对已有的信息，查询电话号或者身份证号是否已存在
   >
   > 如果前端传递的参数中含有随行者id则表示修改，没有则表示添加
   >
   > 添加：使用count函数获取当前展商总随行人数，如果大于等于100，不予添加。添加id、regid、创建者、修改者信息，执行添加
   >
   > 修改: 添加修改者信息，执行修改

   

3. 移除随行人员（DELETE）                        /api/userInfo/web/expoRegAccompany/{id}

   > 验证id是否为空
   >
   > 根据id查询 tb_expo_reg_accompany

4. 查看随行人员信息（GET）                 /api/userInfo/web/expoRegAccompany/{id}

   > 验证id是否为空
   >
   > 根据id删除                        tb_expo_reg_accompany



##### 往届记录

获取往届记录                                 /api/userInfo/web/user/history/all

> 使用JwtHelpper获取当前展商id，根据展商id获取展商信息            tb_expo_exhibitor
>
> 获取所有已经结束的展会的id列表
>
> 循环展会id列表
>
> 根据每一届的id、展商id，获取展商报名信息
>
> 如果报名成功，则联表查询当届展会展商参展详情（）



##### 资源列表

获取资源列表                                    /api/userInfo/web/expoSource/list



##### 广告

/cms/articles/slug/adpc

##### 特殊服务

/cms/articles/slug/slug



##### 展商名录

1. 获取展商名录                                 /exhibitors/catalog

   > 根据传入的query联表查询

   

2. 获取展商二维码                       /registration/qrcode/{id}

   > 调用接口根据传入的id生成二维码
   >
   > 将二维码写入response的输出流

   

3.  获取指定展商信息                           /registration/web/exhibitors/{id}

   > 验证id
   >
   > ​	根据id查询报名表
   >
   > ​	如果存在再根据id查询开票信息表，将开票信息设置到报名信息dto中
   >
   > ​	根据展商id，查询已发布的展品列表，设置到报名信息dto
   >
   > ​	根据展商报名id，查询随行人员信息列表，设置到报名信息dto
   >
   > ​	根据展商id查询展商基础信息，设置到报名信息dto
   >
   > ​	根据展商id、展商报名id查询渠道信息表，将渠道code设置到报名信息dto
   >
   > ​	根据展商id、展商报名id查询参展意图信息表，将参展意图code设置到报名信息dto
   >
   > 根据regid查询所属行业映射表                      tb_expo_industry_field_focus
   >
   > 根据行业id查询所属行业表 ，获取行业名                          tb_expo_industry_field
   >
   > 根据展商id查询该展商参加的所有展会名称
   >
   > 查询展商基础信息
   >
   > 根据regid与展位id查询展位信息
   >
   > 将查询结果全部返回

   



##### 往期展商

1. 获取展会信息             /history/web/expoinfo

   > 根据传入的状态列表查询展会列表

2. 获取展商信息              /exhibitor/catalog

   > 根据查询联表信息查询企业详细信息





## 后端

#### 报名登记

##### 展位预订

1. 获取展商报名信息                     /registration/exhibitors/search

   > 根据query，查询展商报名分页表
   >
   > 查询上传上屏的数量
   >
   > 循环列表，验证信息校验完整度，报名审核通过表示完整
   >
   > 查询推介会场字典对应数据

2. 获取指定展商报名信息             /registration/exhibitors/{id}

   > 验证id
   >
   > ​	根据id查询报名表
   >
   > ​	如果存在再根据id查询开票信息表，将开票信息设置到报名信息dto中
   >
   > ​	根据展商id，查询已发布的展品列表，设置到报名信息dto
   >
   > ​	根据展商报名id，查询随行人员信息列表，设置到报名信息dto
   >
   > ​	根据展商id查询展商基础信息，设置到报名信息dto
   >
   > ​	根据展商id、展商报名id查询渠道信息表，将渠道code设置到报名信息dto
   >
   > ​	根据展商id、展商报名id查询参展意图信息表，将参展意图code设置到报名信息dto
   >
   > 根据regid查询所属行业映射表                      tb_expo_industry_field_focus
   >
   > 根据行业id查询所属行业表 ，获取行业名                          tb_expo_industry_field
   >
   > 将查询结果全部返回                  

3. 修改展商报名信息                                       /registration/exhibitors

   > 验证数据
   >
   > 赋值数据
   >
   > 如果是审核通过，将数据写入到sso用户体系中，根据不同类型发送短信或邮箱通知成功

#####  参展商下届登记                            

> 简单分页                                      /registration/next/search

 

##### 论坛报名

1. 查询高峰论坛列表                          /api/userInfo/admin/dealer/reg/search
2. 获取省市(无区)二级树状信息         /api/expo/region/city-tree
3. 后台嘉宾行程获取参与论坛            /forums/getByType
4. 发送短信                                   /api/userInfo/admin/dealer/reg/send/message
5. 论坛报名记录                           /api/userInfo/admin/forum/focus/record/search



##### 展商快速报名

1. 获取展商列表                              /api/userInfo/admin/exhibitors/search
2. 获取指定展商信息                         /api/userInfo/admin/exhibitors/{id}
3. 快速注册报名                               /api/userInfo/admin/exhibitors/registerAll



#### 展会管理

##### 展区分配

##### 展位分配



#### 用户管理

##### 展商管理

1. 获取展商列表                           /exhibitors/search
2. 获取/删除指定展商信息                 /exhibitors/{id}
3. 获取标签列表                      /exhibitors/listTagByType
4. 添加/修改展商信息                       /exhibitors/
5. 删除展商信息                    

 ##### 随行人员

获取随行人员列表                             /api/userInfo/admin/expoRegAccompany/list



#### 审批管理

##### 展商信息审核

1. 获取展商登记列表                           /api/userInfo/admin/exhibitors/apply/list
2. 审核通过/失败                                /api/userInfo/admin/exhibitors/apply/audit
3. 获取展商信息                                 /api/userInfo/admin/exhibitors/apply/{id}

##### 论坛报名审核

1. 获取论坛报名申请列表                    /api/userInfo/admin/forum/focus/audit/search
2. 审核通过/失败                                /api/userInfo/admin/forum/focus/audit

##### 展品审核

1. 展品分页查询                                /api/userInfo/admin/reg/exhibitor/prod/audit/search
2. 展品审核                                       /api/userInfo/admin/reg/exhibitor/prod/audit
3. 展品详情                                      /api/userInfo/admin/reg/exhibitor/prod/{id}



#### 综合查询

展商展位查询                                      /diverse/exhibitor/booth/search

展商查询（头衔）                             /api/query/admin/search/exhibitor-summary

展商查询（展位类型）                       /api/userInfo/admin/exhibitor/statistics/position/list





## 表的依赖（id）

| tb_expo_advert_position          |                        |
| :------------------------------- | :--------------------- |
| tb_expo_audience                 |                        |
| tb_expo_contact_us               |                        |
| tb_expo_dealer                   |                        |
| tb_expo_exhibitor                |                        |
| tb_expo_exhibitor_apply          |                        |
| tb_expo_hotel                    |                        |
| tb_expo_industry                 |                        |
| tb_expo_info                     |                        |
| tb_expo_lab_switch               |                        |
| tb_expo_message_board            |                        |
| tb_expo_media                    |                        |
| tb_expo_product_introduce_source |                        |
| tb_expo_product_introduce        |                        |
|                                  |                        |
| tb_expo_activity_apply           | tb_expo_info           |
|                                  | tb_expo_area           |
| tb_expo_activity                 | tb_expo_info           |
|                                  | tb_expo_activity_apply |
|                                  |                        |
| tb_expo_area                     | tb_expo_info           |
|                                  |                        |
| tb_expo_area_relation            | tb_expo_reg_exhibitor  |
|                                  | tb_expo_info           |
|                                  | tb_expo_area           |
|                                  |                        |
| tb_expo_booth                    | tb_expo_info           |
|                                  | tb_expo_area           |
|                                  |                        |
| tb_expo_booth_exhibitor          | tb_expo_booth          |
|                                  | tb_expo_exhibitor      |
|                                  |                        |
| tb_expo_curator                  | tb_expo_info           |
|                                  | tb_expo_area           |
|                                  |                        |
| tb_expo_forum                    | tb_expo_info           |
|                                  |                        |
| tb_expo_forum_agenda             | tb_expo_forum          |
|                                  |                        |
| tb_expo_forum_focus              |                        |
|                                  |                        |
| tb_expo_forum_guest              | tb_expo_guest          |
|                                  | tb_expo_forum          |
|                                  |                        |
| tb_expo_forum_order              | tb_expo_info           |
|                                  |                        |
| tb_expo_guest                    | tb_expo_info           |
|                                  |                        |
| tb_expo_guest_plan               | tb_expo_info           |
|                                  | tb_expo_guest          |
|                                  | tb_expo_forum          |
|                                  |                        |
| tb_expo_guest_trip               | tb_expo_guest_plan     |
|                                  | tb_expo_guest          |
|                                  |                        |
| tb_expo_hall_hotel               | tb_expo_hotel          |
|                                  | tb_expo_info           |
|                                  |                        |
| tb_expo_hotel_room               | tb_expo_hotel          |
|                                  |                        |
| tb_expo_hotel_picture            | tb_expo_hotel          |
|                                  |                        |
| tb_expo_inauguration_staff       | tb_expo_info           |
|                                  | tb_expo_area           |
|                                  |                        |
| tb_expo_industry_field           | tb_expo_info           |
|                                  |                        |
| tb_expo_industry_field_focus     | tb_expo_exhibitor      |
|                                  | tb_expo_industry_field |
|                                  |                        |
| tb_expo_invoice_info             | tb_expo_exhibitor      |
|                                  |                        |
| tb_expo_newproduct               | tb_expo_info           |
|                                  |                        |
| tb_expo_program                  | tb_expo_info           |
|                                  |                        |
| tb_expo_question_answer          | tb_expo_info           |
|                                  |                        |
| tb_expo_reg_accompany            | tb_expo_info           |
|                                  | tb_expo_reg_exhibitor  |
|                                  |                        |
| tb_expo_reg_audience             | tb_expo_audience       |
|                                  | tb_expo_info           |
|                                  |                        |
| tb_expo_reg_audience_channel     | tb_expo_info           |
|                                  | tb_expo_reg_exhibitor  |
|                                  |                        |
| tb_expo_reg_dealer               | tb_expo_dealer         |
|                                  | tb_expo_info           |
|                                  |                        |
| tb_expo_reg_employee_card        | tb_expo_info           |
|                                  | tb_expo_area           |
|                                  |                        |
| tb_expo_reg_exhibitor            | tb_expo_info           |
|                                  | tb_expo_exhibitor      |
|                                  |                        |
| tb_expo_reg_exhibitor_channel    | tb_expo_reg_exhibitor  |
|                                  | tb_expo_info           |
|                                  |                        |
| tb_expo_reg_exhibitor_prod       | tb_expo_reg_exhibitor  |
|                                  |                        |
|                                  |                        |
|                                  |                        |
|                                  |                        |

